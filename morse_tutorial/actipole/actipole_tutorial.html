<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-01-27 Wed 16:04 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>Actipole Hands-on</title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="HiePACS/STORM" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" title="Standard" href="../chameleon/css/worg.css" type="text/css" />
<link rel="stylesheet" type="text/css" href="../chameleon/css/VisuGen.css" />
<link rel="stylesheet" type="text/css" href="../chameleon/css/VisuRubriqueEncadre.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Actipole Hands-on</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">1. R analysis functions                                              :noexport</a></li>
<li><a href="#orgheadline8">2. Introduction</a>
<ul>
<li><a href="#orgheadline2">2.1. Goal of this tutorial</a></li>
<li><a href="#orgheadline3">2.2. MORSE distribution via spack</a></li>
<li><a href="#orgheadline4">2.3. Emacs and Org-mode</a></li>
<li><a href="#orgheadline5">2.4. Configure your local working environment</a></li>
<li><a href="#orgheadline6">2.5. Configure Plafrim2</a></li>
<li><a href="#orgheadline7">2.6. Copy matrix and scripts</a></li>
</ul>
</li>
<li><a href="#orgheadline11">3. Installing spack</a>
<ul>
<li><a href="#orgheadline9">3.1. Install spack</a></li>
<li><a href="#orgheadline10">3.2. Set environment variables</a></li>
</ul>
</li>
<li><a href="#orgheadline19">4. OpenSource solvers</a>
<ul>
<li><a href="#orgheadline15">4.1. Install packages</a>
<ul>
<li><a href="#orgheadline12">4.1.1. Get packages from your local machine</a></li>
<li><a href="#orgheadline13">4.1.2. Install on plafrim</a></li>
<li><a href="#orgheadline14">4.1.3. Verify installation</a></li>
</ul>
</li>
<li><a href="#orgheadline16">4.2. Real experiments</a></li>
<li><a href="#orgheadline17">4.3. Simulation</a></li>
<li><a href="#orgheadline18">4.4. Analysis</a></li>
</ul>
</li>
<li><a href="#orgheadline24">5. Proprietary solvers</a>
<ul>
<li><a href="#orgheadline20">5.1. Install packages</a></li>
<li><a href="#orgheadline21">5.2. Real experiments</a></li>
<li><a href="#orgheadline22">5.3. Simulation</a></li>
<li><a href="#orgheadline23">5.4. Analysis</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1"><span class="section-number-2">1</span> R analysis functions                                              :noexport</h2>
<div class="outline-text-2" id="text-1">
<p>
Installing necessary R packages (execute only if these packages have not yet been installed)
</p>
</div>
</div>
<div id="outline-container-orgheadline8" class="outline-2">
<h2 id="orgheadline8"><span class="section-number-2">2</span> Introduction</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2"><span class="section-number-3">2.1</span> Goal of this tutorial</h3>
<div class="outline-text-3" id="text-2-1">
<p>
We created a <a href="https://pad.inria.fr/p/xN3213Pf5uX84P3x_org-actipole">pad</a> for notes, questions, bugs and suggestions
concearning this tutorial.
The goal of this tutorial is to explain, step by step, how to
reproduce experiments, simulation, and analysis over several solvers.
We consider here dense, sparse linear algebra libraries, like
Chameleon, MUMPS, PaStiX, etc.
</p>
</div>
</div>
<div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3"><span class="section-number-3">2.2</span> MORSE distribution via spack</h3>
<div class="outline-text-3" id="text-2-2">

<div class="figure">
<p><img src="./tuto_files/spack-morse-packages.jpg" alt="spack-morse-packages.jpg" width="1000px" />
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline4" class="outline-3">
<h3 id="orgheadline4"><span class="section-number-3">2.3</span> Emacs and Org-mode</h3>
<div class="outline-text-3" id="text-2-3">
<p>
This tutorial is written in <a href="http://orgmode.org/">Org-mode</a> and it is based on its
literate programming feature <a href="http://orgmode.org/worg/org-contrib/babel/">Org-babel</a>. Although Org-mode files can
be read in any text editors, we strongly encourage to use Emacs, as
at this point only this editor allows for fully benefiting from
Org-babel feature.
</p>

<p>
In order to run everything smoothly, you will need recent Emacs
(&gt;24.3) and a recent Org-mode (&gt;8.0). If you have trouble
installing this software, consult the following web <a href="http://mescal.imag.fr/membres/arnaud.legrand/misc/init.php">page</a>
(or this <a href="http://mescal.imag.fr/membres/arnaud.legrand/blog/2014/05/15/emacs_and_orgmode_on_macosx.php">one</a> if you are a Mac user).
</p>

<p>
Once everything is installed, execute the following code by
selecting it with cursor and applying the shortcut "Ctrl-c Ctrl-c"
to test that everything works properly. This small code will
execute shell command echo with the specified text.
</p>
<div class="org-src-container">

<pre class="src src-sh">  echo "foo"
</pre>
</div>

<pre class="example">
foo
</pre>


<p>
Now execute this code to set the environment in order to be able to
execute shell and not have to confirm every command.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp"> (setq org-confirm-babel-evaluate nil)
 (setq org-export-babel-evaluate nil)
 (org-babel-do-load-languages 'org-babel-load-languages
      '(
       (sh . t)
       (python . t)
       (R . t)
       (org . t)
       ))
(setq org-support-shift-select t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-3">
<h3 id="orgheadline5"><span class="section-number-3">2.4</span> Configure your local working environment</h3>
<div class="outline-text-3" id="text-2-4">
<p>
First, prepare a clean directory to work in it. You should execute
this section only once.
If you don't want to use this directory, you're free to work in
another directory, but you still need to set WORK_DIR variable.
</p>

<p>
#+BhoHEGIN_SRC sh :session local :results none
mkdir -p actipole_tutorial
cd actipole_tutorial
export WORK_DIR=$PWD
cd -
#+END_SRC
</p>
</div>
</div>

<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6"><span class="section-number-3">2.5</span> Configure Plafrim2</h3>
<div class="outline-text-3" id="text-2-5">
<p>
You can skip this part if you don't have access to PlaFRIM, but set
WORK_DIR to the path where you want to install everything, run tests, etc.
</p>

<p>
Fill your local ~/.ssh/config file with the missing information accordingly:
Note that you need to be able to access Airbus repositories on hades for some parts of this tutorial.
</p>

<pre class="example">
Host plafrim2
ForwardAgent yes
ForwardX11   yes
RemoteForward 2222 localhost:22
User falco
ProxyCommand ssh -A -l falco ssh.plafrim.fr -W plafrim:22

Host hades
User falco
Port 22
HostName hades
</pre>

<p>
Then, you can connect to plafrim2 with:
</p>

<div class="org-src-container">

<pre class="src src-sh">ssh plafrim2
</pre>
</div>

<p>
Set environment on plafrim.
</p>
<div class="org-src-container">

<pre class="src src-sh" id="orgsrcblock1">module purge
module load slurm/14.03.0
module load compiler/gcc/4.8.4
module load mpi/openmpi
module load intel/mkl/64/11.2
module load build/cmake/3.2.1
module load linalg/openblas/dynamic/0.2.8
module load linalg/blas/open64/64/1
module load runtime/starpu/1.1.5/gcc/fxt-mpi
unset F90
export LIBRARY_PATH=/usr/lib64:$LIBRARY_PATH
export MPI_DIR=$MPI_HOME
export TILE_CPU=320
export TILE_GPU=960
export CUDADIR=$CUDA_PATH
export WORK_DIR=$HOME/actipole_tutorial
mkdir -p $WORK_DIR
cd $WORK_DIR
echo "Environment is set"
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7"><span class="section-number-3">2.6</span> Copy matrix and scripts</h3>
<div class="outline-text-3" id="text-2-6">
<p>
These commands should be called only once.
</p>

<p>
Local analysis scripts:
</p>
<div class="org-src-container">

<pre class="src src-sh">cd $WORK_DIR/..
cp -r tuto_files/analysis $WORK_DIR
cp -r tuto_files/experiments/*.xml $WORK_DIR/analysis/
cd -
</pre>
</div>

<p>
Copy matrices and some scripts to launch experiments on plafrim
</p>
<div class="org-src-container">

<pre class="src src-sh">cd $WORK_DIR/..
scp -r tuto_files/experiments/* plafrim2:actipole_tutorial/
cd -
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline11" class="outline-2">
<h2 id="orgheadline11"><span class="section-number-2">3</span> Installing spack&#xa0;&#xa0;&#xa0;<span class="tag"><span class="_SIROCCO">@SIROCCO</span></span></h2>
<div class="outline-text-2" id="text-3">
<p>
If you have already installed spack (latest version from morse
branch), set correctly your environment, don't need to export it on
PlaFRIM, then you can skip this part.
</p>
</div>

<div id="outline-container-orgheadline9" class="outline-3">
<h3 id="orgheadline9"><span class="section-number-3">3.1</span> Install spack</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Clone Spack git on your local computer and copy the archive on plafrim2:
</p>

<div class="org-src-container">

<pre class="src src-sh">cd $WORK_DIR
git clone https://github.com/fpruvost/spack.git
cd spack
git checkout morse
git pull
git archive -o spack.tar.gz --prefix=spack/ HEAD
scp spack.tar.gz plafrim:actipole_tutorial
</pre>
</div>

<p>
Then, get back spack on PlaFRIM.
</p>
<div class="org-src-container">

<pre class="src src-sh">cd $WORK_DIR
tar xf spack.tar.gz
</pre>
</div>
<p>
This block and the previous one should be executed only once
(except if a new version of spack is out!)
</p>
</div>
</div>

<div id="outline-container-orgheadline10" class="outline-3">
<h3 id="orgheadline10"><span class="section-number-3">3.2</span> Set environment variables</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Local setting for spack
</p>
<div class="org-src-container">

<pre class="src src-sh" id="orgsrcblock2">export SPACK_ROOT=$WORK_DIR/spack
. $SPACK_ROOT/share/spack/setup-env.sh 
export MODULEPATH=$SPACK_ROOT/share/spack/modules/linux-x86_64:$MODULEPATH
mkdir -p $HOME/.spack
echo "Spack environment is set"
</pre>
</div>

<p>
Do the same on PlaFRIM.
</p>
<div class="org-src-container">

<pre class="src src-sh" id="orgsrcblock3">export SPACK_ROOT=$WORK_DIR/spack
. $SPACK_ROOT/share/spack/setup-env.sh 
export MODULEPATH=$SPACK_ROOT/share/spack/modules/linux-x86_64:$MODULEPATH
mkdir -p $HOME/.spack
echo "Spack environment is set"
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline19" class="outline-2">
<h2 id="orgheadline19"><span class="section-number-2">4</span> OpenSource solvers</h2>
<div class="outline-text-2" id="text-4">
<p>
In this section, we will only execute opensource solvers, so you
only need to have configured PlaFRIM as specified before. You need
access to hades for hmat-oss however.
</p>
</div>

<div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15"><span class="section-number-3">4.1</span> Install packages</h3>
<div class="outline-text-3" id="text-4-1">
</div><div id="outline-container-orgheadline12" class="outline-4">
<h4 id="orgheadline12"><span class="section-number-4">4.1.1</span> Get packages from your local machine</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
If you don't have access to PlaFRIM, skip this part.
If you have access, download the software stack used for the experiments via "spack
mirror" to create an archive containing all the sources from each
package so that you can transfer it on PlaFRIM. 
</p>

<p>
#+NAME opensource_mirrors
</p>
<div class="org-src-container">

<pre class="src src-sh">git pull
spack mirror create -d $PWD/spack_mirror hmat-oss@nd
spack mirror create -d $PWD/spack_mirror mumps
spack mirror create -d $PWD/spack_mirror pastix
spack mirror create -d $PWD/spack_mirror cmake
spack mirror create -d $PWD/spack_mirror starpu
spack mirror create -d $PWD/spack_mirror scotch
spack mirror create -d $PWD/spack_mirror hwloc
spack mirror create -d $PWD/spack_mirror mpich
spack mirror create -d $PWD/spack_mirror zlib
spack mirror create -d $PWD/spack_mirror bison
spack mirror create -d $PWD/spack_mirror flex
spack mirror create -d $PWD/spack_mirror simgrid@master
tar czf spack_mirror.tar.gz spack_mirror
scp spack_mirror.tar.gz plafrim:actipole_tutorial
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">tar xf spack_mirror.tar.gz
spack mirror add actipole_mirror file://$WORK_DIR/spack_mirror
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline13" class="outline-4">
<h4 id="orgheadline13"><span class="section-number-4">4.1.2</span> Install on plafrim</h4>
<div class="outline-text-4" id="text-4-1-2">
<p>
Check the stacks to install:
</p>

<div class="org-src-container">

<pre class="src src-sh">spack spec hmat-oss@nd ^mkl-blas
spack spec pastix   +mpi+examples ^mkl-blas
spack spec mumps +examples
spack spec scotch +grf+mpi ^mpich
</pre>
</div>

<p>
Install the one you want to test:
</p>

<div class="org-src-container">

<pre class="src src-sh">spack install -v -n scotch +grf+mpi ^mpich
</pre>
</div>
<div class="org-src-container">

<pre class="src src-sh">spack install -v -n pastix  +mpi+examples ^mkl-blas ^mpich
</pre>
</div>
<div class="org-src-container">

<pre class="src src-sh">spack install -v -n mumps +mpi+examples ^mkl-blas ^mpich
</pre>
</div>

<p>
Source files are place in "/tmp/$USER", and are deleted when the installation is finished.
You can keep source files by using the option &#x2013;keep-stage, but
they will still be kept in /tmp.
</p>

<div class="org-src-container">

<pre class="src src-sh">spack install -v -n --keep-stage scotch +grf+mpi ^mpich
</pre>
</div>

<p>
Otherwise, you can use @src versions, which allows you to use source
files you downloaded by yourself. For example, let's say you have
scotch source installed in $HOME/scotch, you could install scotch
using those sources and spack dependencies with:
</p>
<div class="org-src-container">

<pre class="src src-sh">export SCOTCH_DIR=$HOME/scotch
spack install -v -n scotch@src +grf+mpi ^mpich
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline14" class="outline-4">
<h4 id="orgheadline14"><span class="section-number-4">4.1.3</span> Verify installation</h4>
<div class="outline-text-4" id="text-4-1-3">
<p>
Test SCOTCH implementation with MPICH:
</p>
<div class="org-src-container">

<pre class="src src-sh">spack load mpich
spack load scotch +grf+mpi ^mpich
export SCOTCH_PATH=`spack location -i scotch +grf+mpi ^mpichx`
mpirun -np 3 dgpart 3 $SCOTCH_PATH/grf/3elt.grf
</pre>
</div>

<p>
Test PaStiX
</p>
<div class="org-src-container">

<pre class="src src-sh">spack load  pastix +mpi+examples ^mkl-blas   ^mpich
export PASTIX_PATH=`spack location -i pastix +mpi+examples ^mkl-blas  ^mpich`
mpirun -np 3 ${PASTIX_PATH}/examples/zsimple -mm $PASTIX_PATH/matrix/young4c.mtx
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline16" class="outline-3">
<h3 id="orgheadline16"><span class="section-number-3">4.2</span> Real experiments</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Load modules installed via spack.
</p>
<div class="org-src-container">

<pre class="src src-sh">spack load pastix +examples ^mkl-blas ^scotch
spack load mumps +examples ^mkl-blas
export PASTIX_PATH=`spack location -i pastix +mpi+examples ^mkl-blas  ^mpich`/lib/pastix/examples
export MUMPS_PATH=`spack location -i mumps +mpi+examples ^mkl-blas ^mpich`/lib/mumps/examples
export PATH=$PATH:${PASTIX_PATH}:${MUMPS_PATH}
</pre>
</div>

<p>
And run each solver as you want:
</p>

<div class="org-src-container">

<pre class="src src-sh">./launch_solver.sh --pastix
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline17" class="outline-3">
<h3 id="orgheadline17"><span class="section-number-3">4.3</span> Simulation</h3>
<div class="outline-text-3" id="text-4-3">
<p>
BEWARE: This section is not yet functional. 
</p>

<div class="org-src-container">

<pre class="src src-sh">spack install -v -n scotch +grf+mpi ^simgrid@master+examples
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">spack install -v -n pastix +mpi+examples ^mkl-blas ^simgrid@master+examples
</pre>
</div>
<div class="org-src-container">

<pre class="src src-sh">spack install -v -n mumps +mpi+examples ^mkl-blas  ^simgrid@master+examples
</pre>
</div>

<p>
Test SCOTCH implementation with SIMGRID
</p>
<div class="org-src-container">

<pre class="src src-sh">spack load simgrid@master+examples
spack load scotch +grf+mpi ^simgrid@master+examples
export SCOTCH_PATH=`spack location -i scotch +grf+mpi ^simgrid@master+examples`
export SIMGRID_PATH=`spack location -i simgrid@master+examples`
smpirun -trace -trace-resource -trace-viva -trace-file smpi_traced.trace -hostfile $SIMGRID_PATH/examples/smpi/hostfile -platform $SIMGRID_PATH/examples/smpi/../platforms/small_platform.xml --cfg=path:$SIMGRID_PATH/examples/smpi/../msg --cfg=smpi/cpu_threshold:-1 -np 3 --log=smpi_kernel.thres:warning dgpart 3 $SCOTCH_PATH/grf/3elt.grf
</pre>
</div>

<p>
Test PaStiX
</p>
<div class="org-src-container">

<pre class="src src-sh">spack load simgrid@master+examples
spack load  pastix +mpi+examples ^mkl-blas ^simgrid@master+examples
export PASTIX_PATH=`spack location -i pastix +mpi+examples ^mkl-blas ^simgrid@master+examples`
export SIMGRID_PATH=`spack location -i simgrid@master+examples`
smpirun -trace -trace-resource -trace-viva -trace-file smpi_traced.trace -hostfile $SIMGRID_PATH/examples/smpi/hostfile -platform $SIMGRID_PATH/examples/smpi/../platforms/small_platform.xml --cfg=path:$SIMGRID_PATH/examples/smpi/../msg --cfg=smpi/cpu_threshold:-1 -np 3 --log=smpi_kernel.thres:warning ${PASTIX_PATH}/examples/zsimple -mm $PASTIX_PATH/matrix/young4c.mtx
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline18" class="outline-3">
<h3 id="orgheadline18"><span class="section-number-3">4.4</span> Analysis</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Get output files from plafrim
</p>

<div class="org-src-container">

<pre class="src src-sh">scp -r plafrim2:actipole_tutorial/outputs $WORK_DIR/analysis
</pre>
</div>

<p>
Set new campaign tests to look for. Choose what to plot:
</p>
<div class="org-src-container">

<pre class="src src-sh">cd $WORK_DIR/analysis
./set_new_tests.sh outputs/mtx pastix_default
</pre>
</div>
<p>
or:
</p>
<div class="org-src-container">

<pre class="src src-sh">./set_new_tests.sh outputs/hmat_oss_examples hmat-oss_default
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">make plot
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline24" class="outline-2">
<h2 id="orgheadline24"><span class="section-number-2">5</span> Proprietary solvers</h2>
<div class="outline-text-2" id="text-5">
<p>
In this section, we will execute actipole and print results.
BEWARE: you can do this part only if you have access to hades
repositories.
</p>
</div>

<div id="outline-container-orgheadline20" class="outline-3">
<h3 id="orgheadline20"><span class="section-number-3">5.1</span> Install packages</h3>
<div class="outline-text-3" id="text-5-1">
<p>
You need to have created opensoucre mirrors first.
</p>
<p>
Create mirrors locally via spack.
</p>
<div class="org-src-container">

<pre class="src src-sh">spack mirror create -d $PWD/spack_mirror actipole@nd
spack mirror create -d $PWD/spack_mirror scab@nd
spack mirror create -d $PWD/spack_mirror mpf@nd
spack mirror create -d $PWD/spack_mirror hmat@nd
tar czf spack_mirror.tar.gz spack_mirror
scp spack_mirror.tar.gz plafrim2:actipole_tutorial
</pre>
</div>

<p>
Copy on plafrim.
</p>
<div class="org-src-container">

<pre class="src src-sh">tar xf spack_mirror.tar.gz
spack mirror add actipole_mirror file://$WORK_DIR/spack_mirror
</pre>
</div>

<p>
A little trick to give Spack custom hmat-oss used for experiments:
</p>
<div class="org-src-container">

<pre class="src src-sh">export SPACK_HMATOSS_TAR=$WORK_DIR/spack_mirror/hmat-oss/hmat-oss-nd.tar.gz
</pre>
</div>

<p>
Check the stack to install:
</p>
<div class="org-src-container">

<pre class="src src-sh">spack spec actipole@nd ^mkl-blas ^scotch+esmumps+mpi
</pre>
</div>

<p>
Install the stack:
</p>
<div class="org-src-container">

<pre class="src src-sh">spack install -v -n actipole@nd ^mkl-blas ^scotch+esmumps+mpi
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline21" class="outline-3">
<h3 id="orgheadline21"><span class="section-number-3">5.2</span> Real experiments</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Load modules installed via spack
</p>
<div class="org-src-container">

<pre class="src src-sh">spack load actipole@nd ^mkl-blas ^scotch+esmumps+mpi
</pre>
</div>

<p>
And run each solver with different options (-h to see options)
</p>
<div class="org-src-container">

<pre class="src src-sh">./launch_solver.sh --actipole
./launch_solver.sh --actipole -p mfact
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline22" class="outline-3">
<h3 id="orgheadline22"><span class="section-number-3">5.3</span> Simulation</h3>
<div class="outline-text-3" id="text-5-3">
<p>
You should run the application one first time with smpi&#x2026;
offline/online
</p>


<div class="org-src-container">

<pre class="src src-sh">smpirun -trace -trace-resource -trace-viva -trace-file smpi_traced.trace -hostfile ~/simgrid/examples/smpi/hostfile -platform ~/simgrid/examples/smpi/../platforms/small_platform.xml --cfg=path:~/simgrid/examples/smpi/../msg --cfg=smpi/cpu_threshold:-1 -np 3 --log=smpi_kernel.thres:warning zsimple $WORK_DIR/matrices/mtx/young4c/young4c.mtx
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline23" class="outline-3">
<h3 id="orgheadline23"><span class="section-number-3">5.4</span> Analysis</h3>
<div class="outline-text-3" id="text-5-4">
<p>
Get output files from plafrim
</p>

<div class="org-src-container">

<pre class="src src-sh">scp -r plafrim2:actipole_tutorial/outputs $WORK_DIR/analysis
</pre>
</div>

<p>
Set new campaign tests to look for.
</p>
<div class="org-src-container">

<pre class="src src-sh">./set_new_tests.sh outputs/sphere_small actipole_default
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">make plot
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: HiePACS/STORM</p>
<p class="date">Created: 2016-01-27 Wed 16:04</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
